<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Insect Battle Example</title>
</head>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.8.1/socket.io.js"></script>

    <h1>Insect Battle Lobby</h1>

    <form action="button">
        <button type="button" onclick="select1()">select character 1</button>
        <button type="button" onclick="select2()">select character 2</button>
    </form>

    <div id="cardSelection" style="display:none;">
        <h2>Select a Card</h2>
        <button id="card1" onclick="selectCard(0)">Card 1</button>
        <button id="card2" onclick="selectCard(1)">Card 2</button>
        <button id="card3" onclick="selectCard(2)">Card 3</button>
    </div>

    <button type="button" onclick="joinQueue()">JOIN</button>

    <script>
        const socket = io();
        let playerData = null;
        let selectedCardIndex = null;

        function select1() {
            playerData = {
                name: "minki",
                cards: [
                    { name: "elephant", attack: 30, defend: 10, hp: 1000, speed: 10 },
                    { name: "monkey", attack: 25, defend: 15, hp: 950, speed: 12 },
                    { name: "rabbit", attack: 35, defend: 5, hp: 900, speed: 14 }
                ]
            };
            console.log("Selected character 1");
            showCardSelection();
        }

        function select2() {
            playerData = {
                name: "minking",
                cards: [
                    { name: "dog", attack: 50, defend: 10, hp: 1000, speed: 5 },
                    { name: "cat", attack: 40, defend: 20, hp: 950, speed: 8 },
                    { name: "mouse", attack: 45, defend: 15, hp: 900, speed: 6 }
                ]
            };
            console.log("Selected character 2");
            showCardSelection();
        }

        function showCardSelection() {
            document.getElementById("cardSelection").style.display = "block";
        }

        function selectCard(cardIndex) {
            selectedCardIndex = cardIndex;
            console.log(`Card ${cardIndex + 1} selected`);

            playerData.selectedCard = playerData.cards[selectedCardIndex];            

            socket.emit("selectCard", cardIndex);
        }

        function joinQueue() {
            if (playerData && playerData.cards && playerData.cards.length === 3) {
                socket.emit("joinQueue", playerData);
                console.log("User requested joinQueue");
            } else {
                alert("캐릭터를 먼저 선택하고, 카드를 선택하세요.");
            }
        }

        socket.on("updateStatus", (data) => {
            console.log(`${data.self}의 체력: ${data.selfHp}, ${data.enemy}의 체력: ${data.enemyHp}`);
        });

        socket.on("updateResult", (msg) => {
            alert(msg);
        });

        socket.on("card_length_error", (msg) => {
            alert(msg);
        });

        socket.on("initialStatus", (status) => {
            alert(`상대방이 카드 ${status.enemy}을(를) 선택했습니다!`);
        });

        socket.on("matched", (msg) => {
            alert("matched 이벤트 수신됨: " + msg);
        });
        socket.on("nextRound", (wins) => {
            alert("select next card");
        });
        socket.on("matchResult", (msg) => {
            alert(`matchReuslt: ${msg}`);
        });
    </script>
</body>
</html>